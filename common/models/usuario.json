{
  "name": "Usuario",
  "base": "User",
  "idInjection": true,
  "options": {
    "validateUpsert": true
  },
  "remoting": {
    "normalizeHttpPath": true
  },
  "mixins": {
    "SoftDelete": true
  },
  "properties": {
    "id": {
      "type": "string",
      "id": true,
      "defaultFn": "uuidv4"
    }
  },
  "validations": [],
  "relations": {
    "usuariosCriados": {
      "type": "hasMany",
      "model": "Usuario",
      "foreignKey": "criadoPor"
    },
    "questoesCriadas": {
      "type": "hasMany",
      "model": "Questao",
      "foreignKey": "criadoPor"
    },
    "questoes": {
      "type": "hasMany",
      "model": "Questao",
      "foreignKey": "usuarioId"
    },
    "questoesCedidas": {
      "type": "hasMany",
      "model": "QuestaoCedida",
      "foreignKey": "destinatario"
    },
    "provasCriadas": {
      "type": "hasMany",
      "model": "Prova",
      "foreignKey": "criadoPor"
    },
    "provas": {
      "type": "hasMany",
      "model": "Prova",
      "foreignKey": "usuarioId"
    },
    "tags": {
      "type": "hasMany",
      "model": "Tag",
      "foreignKey": "usuarioId"
    },
    "cadernos": {
      "type": "hasMany",
      "model": "Caderno",
      "foreignKey": "usuarioId"
    },
    "concursos": {
      "type": "hasMany",
      "model": "Concurso",
      "foreignKey": "usuarioId"
    },
    "impressoes": {
      "type": "hasMany",
      "model": "Impressao",
      "foreignKey": "usuarioId"
    },
    "instanciamentos": {
      "type": "hasMany",
      "model": "Instanciamento",
      "foreignKey": "usuarioId"
    },
    "instanciamentosConcursos": {
      "type": "hasMany",
      "model": "InstanciamentoConcursos",
      "foreignKey": "usuarioId"
    },
    "turmas": {
      "type": "hasMany",
      "model": "Turma",
      "foreignKey": "usuarioId"
    },
    "notificacoes": {
      "type": "hasMany",
      "model": "Notificacao",
      "foreignKey": "usuarioId"
    },
    "roles": {
      "type": "hasMany",
      "model": "Role",
      "foreignKey": "principalId",
      "keyThrough": "roleId",
      "through": "RoleMapping"
    }
  },
  "acls": [
    {
      "accessType": "*",
      "principalType": "ROLE",
      "principalId": "$everyone",
      "permission": "DENY"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$everyone",
      "permission": "ALLOW",
      "property": "emailExiste"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$everyone",
      "permission": "ALLOW",
      "property": "forgotPassword"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$everyone",
      "permission": "ALLOW",
      "property": "updateForgottenPassword"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$owner",
      "permission": "ALLOW",
      "property": "updatePassword"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$everyone",
      "permission": "ALLOW",
      "property": "usernameExiste"
    },
    {
      "accessType": "READ",
      "principalType": "ROLE",
      "principalId": "super",
      "permission": "ALLOW"
    },
    {
      "accessType": "WRITE",
      "principalType": "ROLE",
      "principalId": "super",
      "permission": "ALLOW"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "super",
      "permission": "ALLOW",
      "property": "create"
    },
    {
      "accessType": "READ",
      "principalType": "ROLE",
      "principalId": "$owner",
      "permission": "ALLOW"
    },
    {
      "accessType": "READ",
      "principalType": "ROLE",
      "principalId": "admin",
      "permission": "ALLOW"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "admin",
      "permission": "ALLOW",
      "property": "create"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "admin",
      "permission": "ALLOW",
      "property": "deleteById"
    },
    {
      "principalType": "ROLE",
      "principalId": "admin",
      "permission": "ALLOW",
      "property": "patchAttributes"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "admin",
      "permission": "ALLOW",
      "property": "replaceById"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "DENY",
      "property": "create"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "__create__questoes"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "__create__provas"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "__create__tags"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "__create__cadernos"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "__create__concursos"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "__create__turmas"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$owner",
      "permission": "ALLOW",
      "property": "__updateById__turmas"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$owner",
      "permission": "ALLOW",
      "property": "__delete__notificacoes"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "discente",
      "permission": "DENY",
      "property": "create"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$unauthenticated",
      "permission": "DENY",
      "property": "create"
    },
    {
      "accessType": "READ",
      "principalType": "ROLE",
      "principalId": "$everyone",
      "permission": "ALLOW",
      "property": "datetimeServidor"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "usuariosDocente"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "usuariosDiscentes"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "admin",
      "permission": "ALLOW",
      "property": "usuariosComRoles"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "admin",
      "permission": "ALLOW",
      "property": "countUsuariosComRoles"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "usuariosDiscentesByEmail"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "turmasDoDocente"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "gestor",
      "permission": "ALLOW",
      "property": "estatisticasAcademicas"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$owner",
      "permission": "ALLOW",
      "property": "getEstatisticasQuestoesByIdDocente"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "discente",
      "permission": "ALLOW",
      "property": "getEstatisticasInstanciaByIdDiscente"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$owner",
      "permission": "ALLOW",
      "property": "getEstatisticasInstanciaByIdDocente"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "$owner",
      "permission": "ALLOW",
      "property": "getEstatisticasProvaByIdDocente"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "gestor",
      "permission": "ALLOW",
      "property": "estatisticasQuestoes"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "gestor",
      "permission": "ALLOW",
      "property": "estatisticasProvasAplicadas"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "admin",
      "permission": "ALLOW",
      "property": "postAluno"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "postAluno"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "getAcumuladoDasInstancias"
    },
    {
      "accessType": "EXECUTE",
      "principalType": "ROLE",
      "principalId": "docente",
      "permission": "ALLOW",
      "property": "alunosEmLote"
    }
  ],
  "methods": {
    "alunosEmLote": {
      "http": {
        "verb": "get",
        "path": "/alunos-em-lote"
      },
      "description": "É passado um array, onde cada elemento é um email ou matrícula. O endpoint irá retornar um array de alunos que sejam identificados pelo email ou matricula. O endpoint também retornará o array de alunos que não foram identificados",
      "accepts": { "arg": "matriculaOuEmail", "type": "array" },
      "returns": [{ "arg": "alunos", "type": "array" }, { "arg": "alunosPendentes", "type": "array" }]
    },
    "postAluno": {
      "accepts": [
        {
          "arg": "aluno",
          "type": "object",
          "http": {
            "source": "body"
          }
        }
      ],
      "returns": {
        "type": "object",
        "root": true
      },
      "description": "Cadastrar aluno.",
      "http": {
        "verb": "post",
        "path": "/aluno"
      }
    },
    "forgotPassword": {
      "accepts": [
        {
          "arg": "email",
          "type": "string"
        },
        {
          "arg": "redirect_url",
          "type": "string"
        }
      ],
      "description": "Envia uma mensagem com um link para o usuário recuperar a senha.",
      "http": {
        "verb": "post",
        "path": "/forgot-password"
      }
    },
    "updateForgottenPassword": {
      "accepts": [
        {
          "arg": "hashSenha",
          "type": "string"
        },
        {
          "arg": "password",
          "type": "string"
        },
        {
          "arg": "passwordConfirmation",
          "type": "string"
        }
      ],
      "description": "Altera a senha do usuário de acordo com o hash enviado por e-mail.",
      "http": {
        "verb": "post",
        "path": "/update-forgotten-password"
      }
    },
    "updatePassword": {
      "accepts": [
        {
          "arg": "id",
          "type": "string",
          "description": "usuarioId",
          "http": {
            "source": "path"
          }
        },
        {
          "arg": "oldPassword",
          "type": "string"
        },
        {
          "arg": "password",
          "type": "string"
        },
        {
          "arg": "passwordConfirmation",
          "type": "string"
        }
      ],
      "description": "Altera a senha do usuário.",
      "http": {
        "verb": "post",
        "path": "/:id/update-password"
      },
      "returns": {
        "type": "object",
        "root": true
      }
    },
    "emailExiste": {
      "accepts": {
        "arg": "value",
        "type": "string"
      },
      "returns": {
        "arg": "existe",
        "type": "boolean"
      },
      "http": {
        "verb": "post",
        "path": "/email-existe"
      }
    },
    "usernameExiste": {
      "accepts": {
        "arg": "value",
        "type": "string"
      },
      "returns": {
        "arg": "existe",
        "type": "boolean"
      },
      "http": {
        "verb": "post",
        "path": "/username-existe"
      }
    },
    "datetimeServidor": {
      "accepts": [],
      "returns": {
        "arg": "datetime",
        "type": "DateString"
      },
      "http": {
        "verb": "get",
        "path": "/datetime-servidor"
      }
    },
    "usuariosDocente": {
      "accepts": [
        {
          "arg": "value",
          "type": "string",
          "http": {
            "source": "query"
          }
        },
        {
          "arg": "usuariosJaSelecionados",
          "type": "array",
          "http": {
            "source": "query"
          }
        }
      ],
      "returns": {
        "arg": "usuarios",
        "type": "array"
      },
      "description": "Lista os usuarios docentes de acordo com uma string enviada.",
      "http": {
        "verb": "get",
        "path": "/usuarios-docente"
      }
    },
    "usuariosDiscentes": {
      "accepts": [
        {
          "arg": "value",
          "type": "string",
          "http": {
            "source": "query"
          },
          "description": "Nome, e-mail ou matricula do discente, parciais ou completos."
        },
        {
          "arg": "usuariosJaSelecionados",
          "type": "array",
          "http": {
            "source": "query"
          },
          "description": "Lista de ids de usuarios que devem ser filtrados do resultado."
        }
      ],
      "returns": {
        "arg": "usuarios",
        "type": "array"
      },
      "description": "Lista os usuarios discentes de acordo com uma string enviada.",
      "http": {
        "verb": "get",
        "path": "/usuarios-discentes"
      }
    },

    "usuariosComRoles": {
      "accepts": [
        {
          "arg": "filter",
          "type": "object",
          "http": {
            "source": "query"
          },
          "description": "Filtros com os dados para buscar usuários"
        }
      ],
      "returns": {
        "root": true,
        "arg": "usuarios",
        "type": "array"
      },
      "description": "Lista os usuarios da acordo com os filtros, inclusive filtrando perfis",
      "http": {
        "verb": "get",
        "path": "/usuarios-by-roles"
      }
    },

    "countUsuariosComRoles": {
      "accepts": [
        {
          "arg": "whereParams",
          "type": "object",
          "description": "Filtros com os dados para buscar usuários"
        }
      ],
      "returns": {
        "root": true,
        "arg": "count",
        "type": "object"
      },
      "description": "Conta os usuarios da acordo com os filtros, inclusive filtrando perfis",
      "http": {
        "verb": "get",
        "path": "/usuarios-by-roles/count"
      }
    },

    "usuariosDiscentesByEmail": {
      "accepts": [
        {
          "arg": "email",
          "type": "string"
        }
      ],
      "returns": {
        "arg": "usuario",
        "type": "array",
        "root": true
      },
      "description": "Lista os usuarios discentes de acordo com o email.",
      "http": {
        "verb": "get",
        "path": "/usuarios-discentes-by-email"
      }
    },
    "turmasDoDocente": {
      "accepts": [
        {
          "arg": "docenteId",
          "type": "string",
          "required": true,
          "description": "Id do docente."
        }
      ],
      "returns": [
        {
          "type": "array",
          "root": true
        }
      ],
      "description": "Lista de turmas pertencentes ao docente",
      "http": {
        "verb": "get",
        "path": "/turmas-do-docente"
      }
    },
    "estatisticasAcademicas": {
      "accepts": [],
      "returns": [
        {
          "type": "object",
          "root": true
        }
      ],
      "description": "Lista estatísticas de quantidade de usuários alunos, docentes, turmas e provas instanciadas aplicadas.",
      "http": {
        "verb": "get",
        "path": "/estatisticas-academicas"
      }
    },
    "estatisticasQuestoes": {
      "returns": [
        {
          "type": "object",
          "root": true
        }
      ],
      "description": "Lista estatísticas de questões de todos os usuários",
      "http": {
        "verb": "get",
        "path": "/estatisticas-questoes"
      }
    },
    "getEstatisticasQuestoesByIdDocente": {
      "accepts": {
        "arg": "id",
        "type": "string",
        "description": "usuarioId",
        "http": {
          "source": "path"
        }
      },
      "returns": {
        "type": "object",
        "root": true
      },
      "description": "Lista estatísticas de questões do próprio docente.",
      "http": {
        "verb": "get",
        "path": "/:id/estatisticas-questoes"
      }
    },

    "getEstatisticasInstanciaByIdDocente": {
      "accepts": {
        "arg": "id",
        "type": "string",
        "description": "usuarioId",
        "http": {
          "source": "path"
        }
      },
      "returns": {
        "type": "object",
        "root": true
      },
      "description": "Lista estatísticas de instancias aplicadas do próprio docente.",
      "http": {
        "verb": "get",
        "path": "/:id/estatisticas-instancias"
      }
    },
    "getEstatisticasProvaByIdDocente": {
      "accepts": {
        "arg": "id",
        "type": "string",
        "description": "usuarioId",
        "http": {
          "source": "path"
        }
      },
      "returns": {
        "type": "object",
        "root": true
      },
      "description": "Lista estatísticas de provas aplicadas do próprio docente.",
      "http": {
        "verb": "get",
        "path": "/:id/estatisticas-provas"
      }
    },
    "getEstatisticasInstanciaByIdDiscente": {
      "accepts": {
        "arg": "id",
        "type": "string",
        "description": "candidatoId",
        "http": {
          "source": "path"
        }
      },
      "returns": {
        "type": "object",
        "root": true
      },
      "description": "Lista estatísticas de provas instanciadas para o usuário discente.",
      "http": {
        "verb": "get",
        "path": "/:id/estatisticas-provas-discente"
      }
    },
    "estatisticasProvasAplicadas": {
      "accepts": [],
      "returns": [
        {
          "type": "object",
          "root": true
        }
      ],
      "description": "Lista estatísticas de provas aplicadas.",
      "http": {
        "verb": "get",
        "path": "/estatisticas-provas-aplicadas"
      }
    },
    "getAcumuladoDasInstancias": {
      "accepts": {
        "arg": "id",
        "type": "string",
        "description": "usuarioId",
        "http": {
          "source": "path"
        }
      },
      "returns": {
        "type": "object",
        "root": true
      },
      "description": "Retorna um array com a quantidade de provas respondidas pelos discentes nos últimos 12 meses.",
      "http": {
        "verb": "get",
        "path": "/:id/acumulado-das-instancias"
      }
    }
  }
}
